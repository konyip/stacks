name: build all apps
run-name: ${{ github.actor }} is attempting to build all apps on push to respository
on: [push]
jobs:
  setup_build_env:
    uses: ./.github/workflows/setup_build_env.yml
  build_on_push:
    name: Sync and Build
    needs: setup_build_env
    runs-on: ubuntu-latest
    steps:
      - name: Sync Repository Code
        uses: actions/checkout@v3
      - name: Dump root directory
        run: ls -all
      - name: Build all apps
        run: |
          export PATH=/usr/lib/gcc-arm-none-eabi/bin:/usr/lib/arm-none-eabi/bin:$PATH
          python build/build_all.py
      - name: Store All Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: all_elf_files
          path: '*/build/*/gcc/bin/*.elf'
          retention-days: 5
          if-no-files-found: error
