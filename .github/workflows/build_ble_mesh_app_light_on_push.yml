name: build ble mesh app light on push
run-name: ${{ github.actor }} is attempting to build ble mesh app light on push to respository
on:
  push:
    paths:
      - '/home/runner/work/stacks/stacks/ble-apps/build/common/**'
      - '/home/runner/work/stacks/stacks/ble-mesh-apps/build/light/**'
      - '/home/runner/work/stacks/stacks/ble-mesh-apps/include/**'
      - '/home/runner/work/stacks/stacks/ble-mesh-apps/sources/common/**'
      - '/home/runner/work/stacks/stacks/ble-mesh-apps/sources/light/**'
      - '/home/runner/work/stacks/stacks/platform/**'
jobs:
  setup_build_env:
    uses: ./.github/workflows/setup_build_env.yml
  sync_repository:
    name: Sync Repository
    needs: setup_build_env
    runs-on: ubuntu-latest
    steps:
      - name: Sync Repository Code
        uses: actions/checkout@v3
      - name: Dump root directory
        run: ls -all 
  build_on_push:
    name: Build on Push
    needs: sync_repository
    runs-on: ubuntu-latest
    steps:
      - name: Build BLE Mesh App Light
        run: |
          export PATH=/usr/lib/gcc-arm-none-eabi/bin:/usr/lib/arm-none-eabi/bin:$PATH
          make -C ble-mesh-apps/build/light/gcc
      - name: Store Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: ble-mesh-apps-light-elf
          path: /home/runner/work/stacks/stacks/ble-mesh-apps/build/light/gcc/bin/light.elf
          retention-days: 5
